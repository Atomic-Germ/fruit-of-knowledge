% Fragment template for per-spread LaTeX output (no document preamble)
% Each fragment includes a title block (from YAML) and the body produced by the Lua filter.
$if(title)$
\begin{center}
  {\LARGE\bfseries $title$}\\[6pt]
  {\small
    $if(number)$ $number$ $endif$
    $if(draft)$
    % Draft mode: include extra metadata for debugging
    $if(slug)$ \textbullet\ $slug$ $endif$
    $if(updated)$ \textbullet\ Updated: $updated$ $endif$
    $if(public_only_check)$ \textbullet\ Public: $public_only_check$ $endif$
    $endif$
  }
\end{center}
% Production builds should add a single TOC entry per fragment/spread
$if(draft)$
% draft build: do not add canonical TOC entries (keeps debugging output cleaner)
$else$
\addcontentsline{toc}{section}{$title$}
% For production, render the body inside a group with tocdepth=0 so any \subsection
% commands inside the fragment do not write entries to the TOC.
\begingroup
  \setcounter{tocdepth}{0}
  % Locally make \subsection use the starred form so it won't write to the TOC
  \let\oldsubsection\subsection
  \renewcommand{\subsection}[1]{\oldsubsection*{##1}}
$endif$

$body$

$if(draft)$
% nothing to close for draft
$else$
\endgroup
$endif$

\clearpage

$endif$
